<?xml version="1.0" encoding="UTF-8"?>
<model>
	<config>
		<name>User</name>
		<table>users</table>
		<callback>true</callback>
		<repository>true</repository>
		<resource>true</resource>
		<role>true</role>
	</config>
	<fields>
		<field>
			<name>id</name>
			<type>index</type>
			<strategy>uuid</strategy>
		</field>
		<field>
			<name>fullname</name>
			<type>string</type>
			<length>64</length>
		</field>
		<field>
			<name>email</name>
			<type>string</type>
			<length>64</length>
		</field>
		<field>
			<name>password</name>
			<type>string</type>
		</field>
		<field>
			<name>active</name>
			<type>boolean</type>
			<default>false</default>
		</field>
		<field>
			<name>about</name>
			<type>text</type>
			<nullable>true</nullable>
		</field>
		<field>
			<name>profile</name>
			<type>relation</type>
			<relation>OneToOne</relation>
			<targetEntity>Profile</targetEntity>
			<cascades>
				<cascade>persist</cascade>
				<cascade>remove</cascade>
			</cascades>
		</field>
		<field>
			<name>groups</name>
			<type>relation</type>
			<relation>ManyToMany</relation>
			<targetEntity>Group</targetEntity>
			<mappedBy>members</mappedBy>			
			<cascades>
				<cascade>persist</cascade>
				<cascade>remove</cascade>
			</cascades>
		</field>
		<field>
			<name>created</name>
			<type>datetime</type>
		</field>
		<field>
			<name>modified</name>
			<type>datetime</type>
		</field>
	</fields>
	<validations>
		<validation>
			<field>fullname</field>
			<rules>
				<rule>
					<type>notEmpty</type>
					<message>Fullname can't be empty</message>
				</rule>
			</rules>			
		</validation>
		<validation>
			<field>email</field>
			<rules>
				<rule>
					<type>notEmpty</type>
					<message>Email can't be empty</message>
				</rule>
				<rule>
					<type>email</type>
					<message>Email format is not correct</message>
				</rule>
				<rule>
					<type>unique</type>
					<message>Email has been taken, try other email</message>
				</rule>
			</rules>
		</validation>
		<validation>
			<field>password</field>
			<rules>
				<rule>
					<type>notEmpty</type>
					<message>Password can't be empty</message>				
				</rule>
			</rules>
		</validation>		
	</validations>
	<actions>
		<action>
			<name>register</name>
			<code>
if ($this->request->data) {
	$user = new User($this->request->data);
	if ($user->save()) {
		$this->_message('Success');
		$this->redirect('Users::index');
	} else {
		$errors = $user->getErrors();
	}
}

return compact('user', 'errors');
			</code>
		</action>
		<action>
			<name>search</name>
			<code>
if ($this->request->data) {
	$users = User::findAll();
}

return compact('users');			
			</code>
		</action>
	</actions>
</model>